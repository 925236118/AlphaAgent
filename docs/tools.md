# Godot AI Agent 工具文档

本文档介绍了可供 AI 模型使用的 Function Call 工具列表。这些工具允许 AI 助手与 Godot 编辑器进行交互，实现项目信息查询、文件操作、类文档查询等功能。

## 工具总览

| # | 工具名称 | 分类 | 简要描述 |
|---|---------|------|---------|
| 1 | `get_project_info` | 查询 | 获取 Godot 引擎、系统和项目配置信息 |
| 2 | `get_editor_info` | 查询 | 获取编辑器当前打开的场景和脚本状态 |
| 3 | `get_project_file_list` | 查询 | 获取项目中所有文件及其 UID 列表 |
| 4 | `read_file` | 文件操作 | 读取指定文件的内容 |
| 5 | `write_file` | 文件操作 | 写入或覆盖文件内容 |
| 6 | `create_folder` | 文件操作 | 创建文件夹 |
| 7 | `get_class_doc` | 查询 | 获取 Godot 原生类的文档信息 |
| 8 | `add_script_to_scene` | 场景操作 | 将脚本加载到场景节点上 |
| 9 | `sep_script_to_scene` | 场景操作 | 将脚本从场景节点上分离 |
| 10 | `get_image_info` | 查询 | 获取图片文件信息 |
| 11 | `set_singleton` | 配置 | 设置或删除项目自动加载脚本或场景 |
| 12 | `check_script_error` | 调试 | 检查脚本中的语法错误 |
| 13 | `open_resource` | 编辑器操作 | 使用编辑器打开资源文件 |

---

## 详细文档

### 1. get_project_info

**功能说明**：获取当前的 Godot 引擎信息和项目配置信息

**参数**

| 参数名 | 类型 | 必需 | 描述 |
|--------|------|------|------|
| - | - | - | 无需参数 |

**返回值**

| 字段 | 子字段 | 描述 |
|------|--------|------|
| `engine` | `engine_version` | Godot 版本信息 |
| `system` | `cpu_info` | CPU 型号 |
| | `architecture_name` | CPU 架构 |
| | `memory_info` | 内存信息 |
| | `model_name` | 设备型号 |
| | `platform_name` | 平台名称 |
| | `system_version` | 系统版本 |
| | `video_adapter_name` | 显卡名称 |
| | `video_adapter_driver` | 显卡驱动信息 |
| | `rendering_method` | 渲染方法 |
| | `system_time` | 当前系统时间 |
| `project` | `project_name` | 项目名称 |
| | `project_version` | 项目版本 |
| | `project_description` | 项目描述 |
| | `main_scene` | 主场景路径 |
| | `features` | 项目特性列表 |
| | `project.godot` | project.godot 文件内容 |
| | `window` | 窗口配置对象（分辨率、模式等） |
| | `physics` | 物理设置对象（帧率、插值） |
| | `rendering` | 渲染设置对象 |

**使用场景**
- 了解当前开发环境和硬件配置
- 获取项目基本信息和配置
- 调试系统兼容性问题

---

### 2. get_editor_info

**功能说明**：获取当前编辑器的状态信息，包括打开的场景和脚本

**参数**

| 参数名 | 类型 | 必需 | 描述 |
|--------|------|------|------|
| - | - | - | 无需参数 |

**返回值**

| 字段 | 描述 |
|------|------|
| `editor.opened_scenes` | 当前打开的所有场景列表（数组） |
| `editor.current_edited_scene` | 当前正在编辑的场景文件路径 |
| `editor.current_scene_root_node` | 当前场景的根节点对象 |
| `editor.current_opend_script` | 当前选中的脚本文件路径 |
| `editor.opend_scripts` | 所有已打开的脚本文件列表（数组） |

**使用场景**
- 了解当前工作上下文
- 确定需要修改的文件
- 获取场景结构信息
- 自动化操作当前编辑的文件

---

### 3. get_project_file_list

**功能说明**：获取当前项目中所有文件及其 UID 的列表

**参数**

| 参数名 | 类型 | 必需 | 描述 |
|--------|------|------|------|
| `start_path` | string | ❌ | 可以指定读取的目录，必须是以 `res://` 开头的绝对路径。只会返回这个目录下的文件和目录 |
| `interation` | number | ❌ | 迭代的次数，只有 start_path 参数有值时才会生效。如果返回 1，就只会查询一层文件。默认为 -1，查询全部层级 |

**返回值**

| 字段 | 描述 |
|------|------|
| `list` | 文件信息数组 |
| `list[].path` | 文件路径 |
| `list[].uid` | 文件的唯一标识符（UID） |
| `list[].type` | 文件类型（"file" 或 "directory"） |

**过滤规则**

| 类型 | 说明 |
|------|------|
| 忽略目录 | `.godot`、`addons` |
| 忽略文件 | `*.uid` |

**使用场景**
- 浏览项目结构
- 查找特定文件
- 批量操作文件前的准备
- 获取文件的 UID 用于引用

**调用示例**

```json
{
  "start_path": "res://addons",
  "interation": -1
}
```

---

### 4. read_file

**功能说明**：读取指定文件的内容

**参数**

| 参数名 | 类型 | 必需 | 描述 |
|--------|------|------|------|
| `path` | string | ✅ | 文件路径，必须是以 `res://` 开头的绝对路径 |

**返回值**

| 字段 | 描述 |
|------|------|
| `file_path` | 文件路径 |
| `file_uid` | 文件 UID |
| `file_content` | 文件内容（字符串格式） |
| `open_error` | 错误代码（仅在读取失败时返回） |

**使用场景**
- 读取脚本内容进行分析
- 读取配置文件
- 检查文件内容
- 备份文件内容

**调用示例**

```json
{
  "path": "res://player.gd"
}
```

---

### 5. write_file

**功能说明**：全量替换写入文件内容

**参数**

| 参数名 | 类型 | 必需 | 描述 |
|--------|------|------|------|
| `path` | string | ✅ | 文件路径，必须是以 `res://` 开头的绝对路径 |
| `content` | string | ✅ | 需要写入的文件内容 |

**支持的文件格式**

| 扩展名 | 类型 |
|--------|------|
| `.tres` | 资源文件 |
| `.gd` | GDScript 脚本文件 |
| `.gdshader` | Godot 着色器 |
| `.tscn` | 场景文件 |
| `.txt`、`.md` | 文本文件 |
| `.csv` | CSV 文件 |

**返回值**

| 字段 | 描述 |
|------|------|
| `file_path` | 文件路径 |
| `file_uid` | 文件 UID |
| `file_content` | 写入后的文件内容 |
| `open_error` | 错误代码（仅在写入失败时返回） |

**特殊行为**

| 行为 | 说明 |
|------|------|
| 自动更新 | 写入后自动更新编辑器的文件系统 |
| 刷新编辑器 | 写入后刷新脚本编辑器 |
| 重载场景 | 如果是场景文件（.tscn），会自动重新加载 |

**使用场景**
- 创建新脚本
- 修改现有代码
- 生成配置文件
- 批量更新文件

**调用示例**

```json
{
  "path": "res://enemy.gd",
  "content": "extends CharacterBody2D\\n\\nfunc _ready():\\n\\tprint('Enemy spawned')\\n"
}
```

---

### 6. create_folder

**功能说明**：在指定位置创建文件夹

**参数**

| 参数名 | 类型 | 必需 | 描述 |
|--------|------|------|------|
| `path` | string | ✅ | 文件夹路径，必须是以 `res://` 开头的绝对路径 |

**返回值**

| 情况 | 返回值 |
|------|--------|
| 成功 | `{"success": "文件创建成功"}` |
| 已存在 | `{"error": "文件夹已存在，无需创建"}` |
| 失败 | `{"error": "文件夹创建失败，[错误原因]"}` |

**注意事项**

| 项目 | 说明 |
|------|------|
| 重复创建 | 如果文件夹已存在，不会报错，只会提示无需创建 |
| 自动扫描 | 创建后会自动扫描并更新编辑器文件系统 |
| 上级目录 | 上级目录必须存在，不支持递归创建 |

**使用场景**
- 组织项目结构
- 创建新模块目录
- 准备文件存储位置
- 按功能分类文件

**调用示例**

```json
{
  "path": "res://scripts/enemies"
}
```

---

### 7. get_class_doc

**功能说明**：获取 Godot 原生类的文档信息，包含类的属性、方法、参数、返回值、信号、枚举常量、父类、派生类等

**参数**

| 参数名 | 类型 | 必需 | 描述 |
|--------|------|------|------|
| `class_name` | string | ✅ | 需要查询的类名（如 "Node"、"CharacterBody2D"） |
| `signals` | array | ❌ | 需要查询的信号名列表 |
| `properties` | array | ❌ | 需要查询的属性名列表 |
| `enums` | array | ❌ | 需要查询的枚举名列表 |

**返回值（完整查询）**

| 字段 | 描述 |
|------|------|
| `class_name` | 类名 |
| `api_type` | API 类型 |
| `properties` | 所有属性列表（数组） |
| `methods` | 所有方法列表（数组） |
| `enums` | 所有枚举列表（数组） |
| `parent_class` | 父类名称 |
| `inheriters_class` | 派生类列表（数组） |
| `signals` | 所有信号列表（数组） |
| `constants` | 所有整数常量列表（数组） |

**返回值（查询特定信号）**

| 字段 | 描述 |
|------|------|
| `class_name` | 类名 |
| `signals` | 指定信号的详细信息（数组） |

**返回值（查询特定属性）**

| 字段 | 描述 |
|------|------|
| `class_name` | 类名 |
| `properties[].default_value` | 默认值 |
| `properties[].setter` | 设置器方法名 |
| `properties[].getter` | 获取器方法名 |

**返回值（查询特定枚举）**

| 字段 | 描述 |
|------|------|
| `class_name` | 类名 |
| `enums[].enum` | 枚举名 |
| `enums[].values` | 枚举值列表（数组） |

**使用场景**
- 学习 Godot API
- 查找类的方法和属性
- 了解类的继承关系
- 查询枚举值和常量

**调用示例 1 - 完整查询**

```json
{
  "class_name": "Node"
}
```

**调用示例 2 - 查询特定枚举**

```json
{
  "class_name": "Node",
  "enums": ["ProcessMode", "ProcessThreadMessages"]
}
```

**调用示例 3 - 查询特定属性**

```json
{
  "class_name": "CharacterBody2D",
  "properties": ["velocity", "motion_mode"]
}
```

---

### 8. add_script_to_scene

**功能说明**：将一个脚本加载到场景节点上，如果需要为节点挂载脚本，应优先使用本工具

**参数**

| 参数名 | 类型 | 必需 | 描述 |
|--------|------|------|------|
| `scene_path` | string | ✅ | 场景文件路径，必须是以 `res://` 开头的绝对路径 |
| `script_path` | string | ✅ | 脚本文件路径，必须是以 `res://` 开头的绝对路径 |

**返回值**

| 字段 | 描述 |
|------|------|
| `scene_class` | 场景文件的类名 |
| `script_class` | 脚本实例的基类类型 |
| `success` | 成功时返回 "脚本加载成功" |
| `error` | 失败时返回错误信息（如 "场景节点类型与脚本继承类型不符"、"文件非场景节点和脚本的关系"、"该场景节点已挂载脚本" 等） |

**使用场景**
- 为场景节点挂载脚本
- 自动化绑定脚本和场景
- 替换场景节点的脚本

**调用示例**

```json
{
  "scene_path": "res://scenes/player.tscn",
  "script_path": "res://scripts/player.gd"
}
```

---

### 9. sep_script_to_scene

**功能说明**：将一个节点上的脚本分离，如果需要为节点分离脚本，应优先使用本工具

**参数**

| 参数名 | 类型 | 必需 | 描述 |
|--------|------|------|------|
| `scene_path` | string | ✅ | 场景文件路径，必须是以 `res://` 开头的绝对路径 |

**返回值**

| 字段 | 描述 |
|------|------|
| `success` | 成功时无返回值（仅更新场景文件） |
| `error` | 失败时返回错误信息（如 "场景文件并未挂在脚本"、"场景文件不存在" 等） |

**使用场景**
- 移除场景节点上的脚本
- 清理不再需要的脚本绑定
- 重置场景节点的脚本状态

**调用示例**

```json
{
  "scene_path": "res://scenes/player.tscn"
}
```

---

### 10. get_image_info

**功能说明**：获取图片文件信息，可以获得图片的格式、大小、uid等信息

**参数**

| 参数名 | 类型 | 必需 | 描述 |
|--------|------|------|------|
| `image_path` | string | ✅ | 图片文件路径，必须是以 `res://` 开头的绝对路径 |

**返回值**

| 字段 | 描述 |
|------|------|
| `uid` | 图片资源的 UID |
| `image_path` | 图片文件路径 |
| `image_file_type` | 图片文件扩展名 |
| `image_width` | 图片宽度（像素） |
| `image_height` | 图片高度（像素） |
| `image_format` | 图片格式（数值） |
| `image_format_name` | 图片格式名称 |
| `data_size` | 图片数据大小 |

**使用场景**
- 获取图片尺寸信息
- 检查图片格式
- 获取图片资源的 UID
- 分析图片文件属性

**调用示例**

```json
{
  "image_path": "res://icon.svg"
}
```

---

### 11. set_singleton

**功能说明**：设置或删除项目自动加载脚本或场景

**参数**

| 参数名 | 类型 | 必需 | 描述 |
|--------|------|------|------|
| `name` | string | ✅ | 自动加载名称，需要以大驼峰的方式命名。一般可以和脚本或场景文件同名。 |
| `path` | string | ❌ | 需要设置为自动加载的脚本或场景路径，必须是以 `res://` 开头的绝对路径。如果为空则删除该自动加载。 |

**返回值**

| 字段 | 描述 |
|------|------|
| `name` | 自动加载名称 |
| `path` | 自动加载路径（仅添加时返回） |
| `success` | 操作成功信息（如 "添加自动加载成功"、"删除自动加载成功"） |

**使用场景**
- 动态添加自动加载脚本
- 删除不再需要的自动加载
- 管理项目全局单例
- 配置插件依赖

**调用示例 1 - 添加自动加载**

```json
{
  "name": "GameManager",
  "path": "res://scripts/game_manager.gd"
}
```

**调用示例 2 - 删除自动加载**

```json
{
  "name": "GameManager"
}
```

---

### 12. check_script_error

**功能说明**：使用 Godot 脚本引擎检查脚本中的语法错误，只能检查 gd 脚本

**参数**

| 参数名 | 类型 | 必需 | 描述 |
|--------|------|------|------|
| `path` | string | ✅ | 需要检查的脚本路径，必须是以 `res://` 开头的绝对路径 |

**返回值**

| 字段 | 描述 |
|------|------|
| `script_path` | 脚本文件路径 |
| `script_check_result` | 脚本检查结果（包含语法错误信息） |

**工作原理**
1. 使用 `OS.create_instance()` 创建一个独立的 Godot 实例来检查脚本
2. 通过 `--head-less`、`--script`、`--check-only` 等参数运行脚本检查
3. 将检查结果保存到临时日志文件中
4. 读取日志文件内容作为返回结果

**使用场景**
- 检查脚本语法是否正确
- 验证脚本是否可以正常编译
- 调试脚本错误

**调用示例**

```json
{
  "path": "res://scripts/player.gd"
}
```

---

### 13. open_resource

**功能说明**：使用 Godot 编辑器立刻打开或切换到对应资源，资源应是场景文件（.tscn）或脚本文件（.gd）

**参数**

| 参数名 | 类型 | 必需 | 描述 |
|--------|------|------|------|
| `path` | string | ✅ | 需要打开的资源路径，必须是以 `res://` 开头的绝对路径 |
| `type` | string | ✅ | 打开的类型，必须是 "scene" 或 "script" |
| `line` | number | ❌ | 如果打开的是脚本，可以指定行号，默认是 -1 |
| `column` | number | ❌ | 如果打开的是脚本，可以指定列号，默认是 0 |

**返回值**

| 字段 | 描述 |
|------|------|
| `success` | 操作成功时返回 "打开成功" |
| `error` | 操作失败时返回错误信息 |

**使用场景**
- 自动打开需要编辑的场景文件
- 跳转到脚本的特定行号
- 切换编辑器焦点到指定资源
- 自动化工作流中的资源导航

**调用示例 1 - 打开场景**

```json
{
  "path": "res://scenes/player.tscn",
  "type": "scene"
}
```

**调用示例 2 - 打开脚本并跳转到指定行**

```json
{
  "path": "res://scripts/player.gd",
  "type": "script",
  "line": 42,
  "column": 0
}
```

---

## 使用指南

### 路径格式规范

| 格式 | 示例 | 状态 |
|------|------|------|
| Godot 资源路径（正确） | `res://scripts/player.gd` | ✅ |
| 绝对路径（错误） | `E:\\workspace\\GameProject\\godot-ai-agent\\scripts\\player.gd` | ❌ |
| 相对路径（错误） | `scripts/player.gd` | ❌ |

### 工作流程建议

| 步骤 | 操作 | 使用工具 |
|------|------|----------|
| 1 | 了解环境 | `get_project_info`、`get_editor_info` |
| 2 | 浏览文件 | `get_project_file_list` |
| 3 | 读取内容 | `read_file` |
| 4 | 修改文件 | `write_file` |
| 5 | 组织结构 | `create_folder` |
| 6 | 查询 API | `get_class_doc` |
| 7 | 场景脚本绑定 | `add_script_to_scene`、`sep_script_to_scene` |
| 8 | 图片信息查询 | `get_image_info` |
| 9 | 自动加载管理 | `set_singleton` |
| 10 | 脚本调试 | `check_script_error` |
| 11 | 编辑器导航 | `open_resource` |

### 最佳实践

| 实践 | 说明 |
|------|------|
| 读取前确认 | 在写入文件前，先使用 `read_file` 读取现有内容 |
| 路径检查 | 使用 `get_project_file_list` 确认文件路径是否正确 |
| API 查询 | 不确定 Godot 类的用法时，使用 `get_class_doc` 查询 |
| 结构规划 | 批量创建文件前，先用 `create_folder` 建立目录结构 |
| 脚本挂载 | 为场景节点挂载脚本时，使用 `add_script_to_scene` 确保类型兼容 |
| 资源管理 | 使用 `set_singleton` 管理全局单例，避免直接修改 project.godot |
| 脚本验证 | 修改脚本后，使用 `check_script_error` 验证语法正确性 |
| 编辑器集成 | 使用 `open_resource` 自动化编辑器导航，提高工作效率 |

---

## 错误处理

### 常见错误类型

| 错误类型 | 可能原因 | 解决方案 |
|----------|----------|----------|
| 文件不存在 | 路径错误或文件未创建 | 检查路径是否正确，是否使用了 `res://` 前缀 |
| 权限不足 | 文件被锁定或只读 | 确保文件不是只读状态 |
| 类不存在 | 类名拼写错误 | 检查类名拼写是否正确（区分大小写） |
| 上级目录不存在 | 创建文件夹时路径无效 | 先创建上级目录 |
| 类型不匹配 | 脚本和场景节点类型不一致 | 检查脚本继承的类是否与场景节点类型匹配 |
| 已挂载脚本 | 场景节点已有脚本 | 先使用 `sep_script_to_scene` 分离脚本 |
| 语法错误 | 脚本包含编译错误 | 使用 `check_script_error` 检查脚本语法 |

### 错误字段

| 字段名 | 说明 |
|--------|------|
| `error` | 错误信息（字符串描述） |
| `open_error` | 文件操作错误代码（数值） |

---

## 版本信息

| 项目 | 值 |
|------|-----|
| 文档基于 | `addons/agent/tools/tools.gd` |
| 更新日期 | 2025-12-05 |
| 工具数量 | 13 |

